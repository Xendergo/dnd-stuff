import{S as H,C as O,c as V}from"./data.d4663666.js";import{S as R,i as U,s as J,e as u,t as D,a as F,b as g,c as z,d as s,m as w,l as A,p as C,n as T,f as k,r as W,q as X,o as $,u as Y,v as Z,w as tt,x as et,y as nt,z as at,A as rt,B as lt,g as K}from"./vendor.e829cda8.js";function it(t){let e=st(t);return e===null?null:e()}const B=new Map;function st(t){let e=t.toLowerCase().replaceAll(" ","");if(B.has(e))return B.get(e);let a=ut(e),n=ct(a);return B.set(e,n),n}function ut(t){let e=[];for(let a=0;a<t.length;)if(t[a]==="d"){let n=Q(t.slice(a));if(n===null)return null;e.push(n[0]),a+=n[1]}else if(t[a].match(/\d/g)!==null){let n=_t(t.slice(a));if(n===null)return null;e.push(n[0]),a+=n[1]}else if(t[a].match(/[\+\-\*]/g)!==null)e.push(t[a]),a++;else return null;return e}function ct(t){let e=G(t);return e===!1?null:N(e)}function G(t){if(!Array.isArray(t)||t[0]==="const"||t[0]==="roll")return[t];let e=t.indexOf("*");if(e===-1&&(e=t.findIndex(a=>a==="+"||a==="-")),e!==-1){if(e<1||e>t.length-2)return!1;let a=G(t[e-1]),n=t[e],r=G(t[e+1]);return a===!1||r===!1||(t.splice(e-1,3,[a,n,r]),!Array.isArray(a)||!Array.isArray(r))?!1:G(t)}return t}function N(t){if(t.length===1&&Array.isArray(t[0]))return t[0][0]==="const"?ot(t[0][1]):t[0][0]==="roll"?ft(t[0][1],t[0][2]):N(t[0]);if(t.length===3&&Array.isArray(t[0])&&typeof t[1]=="string"&&Array.isArray(t[2])){let e=N(t[0]),a=N(t[2]);if(t[1]==="+")return pt(e,a);if(t[1]==="-")return ht(e,a);if(t[1]==="*")return dt(e,a)}}function ot(t){return()=>t}function ft(t,e){return()=>{let a=0;for(let n=0;n<e;n++)a+=Math.floor(Math.random()*t+1);return a}}function pt(t,e){return()=>t()+e()}function ht(t,e){return()=>t()-e()}function dt(t,e){return()=>t()*e()}function Q(t){let e=1,a=t.slice(e).match(/\d+/g);return a===null?null:(e+=a[0].length,[["roll",parseInt(a[0]),1],e])}function _t(t){let e=0,a=t.slice(e).match(/\d+/g)[0],n=parseInt(a);if(e+=a.length,t[e]==="d"){let r=Q(t.slice(e));return r===null?null:(e+=r[1],[["roll",r[0][1],n],e])}else return[["const",n],e]}function mt(t){let e,a,n,r,o,l,d,f,i,p,h,y,c,v,b,L,x,P,I,q,_,M,j,E;return{c(){e=u("table"),a=u("tr"),n=u("td"),r=u("p"),o=D("HP "),l=u("input"),d=u("button"),d.textContent="-1",f=u("button"),f.textContent="+1",i=u("button"),i.textContent="\u{1F504}",p=F(),h=u("tr"),y=u("td"),c=u("p"),v=D("max HP "),b=u("input"),L=F(),x=u("tr"),P=u("td"),I=u("p"),q=D("Initiative "),_=u("input"),M=u("button"),M.textContent="\u{1F3B2}",g(l,"type","number"),g(l,"class","svelte-1jgdz0f"),g(b,"type","number"),g(b,"class","svelte-1jgdz0f"),g(_,"type","number"),g(_,"min","1"),g(_,"max","20"),g(_,"class","svelte-1jgdz0f")},m(m,S){z(m,e,S),s(e,a),s(a,n),s(n,r),s(r,o),s(r,l),w(l,t[1].hp),s(r,d),s(r,f),s(r,i),s(e,p),s(e,h),s(h,y),s(y,c),s(c,v),s(c,b),w(b,t[1].hp_max),s(e,L),s(e,x),s(x,P),s(P,I),s(I,q),s(I,_),w(_,t[1].initiative),s(I,M),j||(E=[A(l,"input",t[2]),A(d,"click",t[3]),A(f,"click",t[4]),A(i,"click",t[5]),A(b,"input",t[6]),A(_,"input",t[7]),A(M,"click",t[8])],j=!0)},p(m,[S]){S&2&&C(l.value)!==m[1].hp&&w(l,m[1].hp),S&2&&C(b.value)!==m[1].hp_max&&w(b,m[1].hp_max),S&2&&C(_.value)!==m[1].initiative&&w(_,m[1].initiative)},i:T,o:T,d(m){m&&k(e),j=!1,W(E)}}}function bt(t,e,a){let n,r=T,o=()=>(r(),r=X(l,v=>a(1,n=v)),l);t.$$.on_destroy.push(()=>r());let{character:l}=e;o();function d(){n.hp=C(this.value),l.set(n)}const f=()=>$(l,n.hp-=1,n),i=()=>$(l,n.hp+=1,n),p=()=>$(l,n.hp=n.hp_max,n);function h(){n.hp_max=C(this.value),l.set(n)}function y(){n.initiative=C(this.value),l.set(n)}const c=()=>{$(l,n.initiative=it("d20"),n)};return t.$$set=v=>{"character"in v&&o(a(0,l=v.character))},[l,n,d,f,i,p,h,y,c]}class gt extends R{constructor(e){super();U(this,e,bt,mt,J,{character:0})}}function yt(t){let e,a,n,r,o,l;document.title=e=""+(t[1]+" | Character data");function d(i){t[3](i)}let f={};return t[0]!==void 0&&(f.character=t[0]),r=new gt({props:f}),Y.push(()=>Z(r,"character",d)),{c(){a=F(),n=u("main"),tt(r.$$.fragment)},m(i,p){z(i,a,p),z(i,n,p),et(r,n,null),l=!0},p(i,[p]){(!l||p&2)&&e!==(e=""+(i[1]+" | Character data"))&&(document.title=e);const h={};!o&&p&1&&(o=!0,h.character=i[0],nt(()=>o=!1)),r.$set(h)},i(i){l||(at(r.$$.fragment,i),l=!0)},o(i){rt(r.$$.fragment,i),l=!1},d(i){i&&k(a),i&&k(n),lt(r)}}}function vt(t,e,a){let n,r;K(t,O,c=>a(5,r=c));const o=new URLSearchParams(window.location.search);let l=o.get("character");l===null&&(window.location.href="../");let d=o.get("gm")==="true",f=o.get("campaign");d&&(f===null||!Object.keys(r).includes(f))&&(location.href="../");let i=d?new H(r[f],c=>O.notifySubscribers()):V;K(t,i,c=>a(4,n=c));let p=n.findIndex(c=>c.name===l);p===-1&&(window.location.href="../");let h=new H(n[p],c=>i.notifySubscribers());function y(c){h=c,a(0,h)}return[h,l,i,y]}class At extends R{constructor(e){super();U(this,e,vt,yt,J,{})}}new At({target:document.getElementById("app")});
